name: Build store front and upload to azure blog storage

on:
  push:
    branches:
      - main
    paths:
      - src/client/SSW.SophieBot.Web/**
      - .github/workflows/SSW.SophieBot.Web.yml

jobs:
  build-and-upload:
    runs-on: ubuntu-latest
    steps:
      - name: check out branch
        uses: actions/checkout@v2

      - name: set up Node.js version
        uses: actions/setup-node@v1
        with:
          node-version: "14.x"

      - name: install and build
        run: |
          yarn install
          yarn build
        working-directory: src/client/SSW.SophieBot.Web

      - name: upload to storage account
        uses: bacongobbler/azure-blob-storage-upload@v1.2.0
        with:
          source_dir: src/client/SSW.SophieBot.Web/dist
          container_name: "$web"
          connection_string: ${{ secrets.WEBBLOBSTORAGECONNECTIONSTRING }}
          sync: true
